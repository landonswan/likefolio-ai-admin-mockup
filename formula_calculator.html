<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LikeFolio.ai Formula Calculator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #0f0f0f;
            color: #e0e0e0;
            padding: 15px;
            overflow: hidden;
        }

        .container {
            max-width: 100%;
            height: calc(100vh - 30px);
            display: flex;
            flex-direction: column;
        }

        .header {
            text-align: center;
            margin-bottom: 15px;
        }

        .header h1 {
            font-size: 24px;
            color: #4a9eff;
            margin-bottom: 5px;
        }

        .header p {
            color: #888;
            font-size: 13px;
        }

        .calculator-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            flex: 1;
            overflow: hidden;
        }

        .panel {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .panel h2 {
            font-size: 16px;
            margin-bottom: 12px;
            color: #4a9eff;
            border-bottom: 1px solid #333;
            padding-bottom: 8px;
        }

        .input-group {
            margin-bottom: 12px;
        }

        .input-group label {
            display: block;
            margin-bottom: 4px;
            color: #b0b0b0;
            font-size: 12px;
            font-weight: 500;
        }

        .input-group input,
        .input-group select {
            width: 100%;
            padding: 8px 12px;
            background: #0f0f0f;
            border: 1px solid #333;
            border-radius: 6px;
            color: #e0e0e0;
            font-size: 13px;
            font-family: inherit;
        }

        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: #4a9eff;
        }

        .grade-selector {
            display: flex;
            gap: 6px;
        }

        .grade-btn {
            flex: 1;
            padding: 8px;
            border-radius: 6px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            border: 2px solid transparent;
            transition: all 0.2s;
            font-size: 13px;
        }

        .grade-btn:hover {
            transform: scale(1.05);
        }

        .grade-btn.selected {
            border-color: #fff;
            box-shadow: 0 0 8px rgba(255,255,255,0.3);
        }

        .grade-A { background: #22c55e; color: #000; }
        .grade-B { background: #84cc16; color: #000; }
        .grade-C { background: #eab308; color: #000; }
        .grade-D { background: #f97316; color: #000; }
        .grade-F { background: #ef4444; color: #fff; }

        /* Theme Management */
        .theme-list {
            margin-top: 8px;
            max-height: 180px;
            overflow-y: auto;
        }

        .theme-item {
            background: #0f0f0f;
            border: 1px solid #333;
            border-radius: 6px;
            padding: 10px;
            margin-bottom: 8px;
            display: grid;
            grid-template-columns: 1fr auto auto;
            gap: 8px;
            align-items: center;
        }

        .theme-name {
            font-weight: 600;
            color: #e0e0e0;
        }

        .theme-controls {
            display: flex;
            gap: 6px;
            align-items: center;
        }

        .strength-select {
            padding: 4px 8px;
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 4px;
            color: #e0e0e0;
            font-size: 12px;
            font-weight: 600;
        }

        .strength-plus-2 { background: #22c55e; color: #000; }
        .strength-plus-1 { background: #84cc16; color: #000; }
        .strength-0 { background: #6b7280; color: #fff; }
        .strength-minus-1 { background: #f97316; color: #000; }
        .strength-minus-2 { background: #ef4444; color: #fff; }

        .relationship-select {
            padding: 4px 8px;
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 4px;
            color: #e0e0e0;
            font-size: 12px;
        }

        .remove-btn {
            padding: 4px 10px;
            background: #ef4444;
            border: none;
            border-radius: 4px;
            color: #fff;
            cursor: pointer;
            font-weight: 600;
            font-size: 12px;
        }

        .remove-btn:hover {
            background: #dc2626;
        }

        .add-theme-btn {
            width: 100%;
            padding: 8px;
            background: #2a4a7c;
            border: none;
            border-radius: 6px;
            color: #fff;
            cursor: pointer;
            font-weight: 600;
            margin-top: 8px;
            font-size: 12px;
        }

        .add-theme-btn:hover {
            background: #3a5a8c;
        }

        /* Results Panel */
        .results-panel {
            display: flex;
            gap: 15px;
        }

        .calculation-steps {
            display: flex;
            gap: 15px;
            flex: 1;
        }

        .calc-card {
            background: #0f0f0f;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 12px;
            flex: 1;
        }

        .calc-card h3 {
            font-size: 13px;
            color: #4a9eff;
            margin-bottom: 8px;
        }

        .calc-step {
            color: #b0b0b0;
            font-size: 11px;
            line-height: 1.5;
            font-family: 'Courier New', monospace;
        }

        .calc-result {
            font-size: 20px;
            font-weight: 600;
            color: #22c55e;
            margin-top: 8px;
        }

        .final-recommendation {
            background: linear-gradient(135deg, #1a1a1a, #2a2a2a);
            border: 2px solid #4a9eff;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            min-width: 250px;
        }

        .rec-label {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .rec-strong-buy { color: #22c55e; }
        .rec-buy { color: #84cc16; }
        .rec-neutral { color: #eab308; }
        .rec-sell { color: #f97316; }
        .rec-strong-sell { color: #ef4444; }

        .rec-score {
            font-size: 24px;
            color: #888;
            margin-bottom: 10px;
        }

        .rec-breakdown {
            font-size: 12px;
            color: #b0b0b0;
            line-height: 1.4;
        }

        .input-hint {
            font-size: 10px;
            color: #666;
            margin-top: 2px;
        }

        .theme-impact {
            font-size: 11px;
            color: #888;
            margin-left: 6px;
            font-weight: 600;
        }

        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #1a1a1a;
        }

        ::-webkit-scrollbar-thumb {
            background: #333;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>LikeFolio.ai Formula Calculator</h1>
            <p>Interactive calculator for testing the recommendation formulas</p>
        </div>

        <div class="calculator-grid">
            <!-- Main Street Inputs -->
            <div class="panel">
                <h2>Main Street Inputs</h2>
                
                <div class="input-group">
                    <label>Swan Grade</label>
                    <div class="grade-selector">
                        <div class="grade-btn grade-A selected" data-grade="A" onclick="selectGrade('A')">A</div>
                        <div class="grade-btn grade-B" data-grade="B" onclick="selectGrade('B')">B</div>
                        <div class="grade-btn grade-C" data-grade="C" onclick="selectGrade('C')">C</div>
                        <div class="grade-btn grade-D" data-grade="D" onclick="selectGrade('D')">D</div>
                        <div class="grade-btn grade-F" data-grade="F" onclick="selectGrade('F')">F</div>
                    </div>
                </div>

                <div class="input-group">
                    <label>Consumer Heat Score (0-100)</label>
                    <input type="number" id="consumer-score" value="75" min="0" max="100" oninput="calculate()">
                    <div class="input-hint">Monthly value from Zach's system</div>
                </div>

                <div class="input-group">
                    <label>Web Data YoY % (-50 to +50)</label>
                    <input type="number" id="web-yoy" value="20" min="-50" max="50" step="0.1" oninput="calculate()">
                    <div class="input-hint">Year-over-year web traffic growth</div>
                </div>
            </div>

            <!-- Wall Street Inputs -->
            <div class="panel">
                <h2>Wall Street Inputs</h2>

                <div class="input-group">
                    <label>Headline Heat Score (0-100)</label>
                    <input type="number" id="headline-score" value="60" min="0" max="100" oninput="calculate()">
                    <div class="input-hint">Daily value from Zach's system</div>
                </div>

                <div class="input-group">
                    <label>Ticker Heat Score (0-100)</label>
                    <input type="number" id="ticker-score" value="55" min="0" max="100" oninput="calculate()">
                    <div class="input-hint">Daily value from Zach's system</div>
                </div>

                <div class="input-group">
                    <label>Stock Price QoQ % (-50 to +50)</label>
                    <input type="number" id="stock-qoq" value="15" min="-50" max="50" step="0.1" oninput="calculate()">
                    <div class="input-hint">Quarter-over-quarter price change</div>
                </div>
            </div>

            <!-- Theme Inputs -->
            <div class="panel">
                <h2>Themes</h2>
                
                <div id="theme-list" class="theme-list">
                    <!-- Themes will be added here -->
                </div>

                <button class="add-theme-btn" onclick="addTheme()">+ Add Theme</button>
            </div>

            <!-- Results -->
            <div class="panel results-panel">
                <div class="calculation-steps">
                    <div class="calc-card">
                        <h3>Main Street</h3>
                        <div class="calc-step" id="main-street-calc"></div>
                        <div class="calc-result" id="main-street-result">0.0</div>
                    </div>

                    <div class="calc-card">
                        <h3>Wall Street</h3>
                        <div class="calc-step" id="wall-street-calc"></div>
                        <div class="calc-result" id="wall-street-result">0.0</div>
                    </div>

                    <div class="calc-card">
                        <h3>Theme</h3>
                        <div class="calc-step" id="theme-calc"></div>
                        <div class="calc-result" id="theme-result">0.0</div>
                    </div>
                </div>

                <div class="final-recommendation">
                    <div class="rec-label" id="recommendation">NEUTRAL</div>
                    <div class="rec-score">Score: <span id="normalized-score">50.0</span></div>
                    <div class="rec-breakdown" id="breakdown">
                        <span id="breakdown-main">0</span> + 
                        <span id="breakdown-theme">0</span> - 
                        <span id="breakdown-wall">0</span> = 
                        <span id="breakdown-raw">0</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let selectedGrade = 'A';
        let themes = [];
        let themeIdCounter = 0;

        const gradeRanges = {
            'A': [70, 100],
            'B': [50, 80],
            'C': [25, 75],
            'D': [20, 50],
            'F': [0, 30]
        };

        function selectGrade(grade) {
            selectedGrade = grade;
            document.querySelectorAll('.grade-btn').forEach(btn => {
                btn.classList.remove('selected');
                if (btn.dataset.grade === grade) {
                    btn.classList.add('selected');
                }
            });
            calculate();
        }

        function addTheme() {
            const theme = {
                id: themeIdCounter++,
                name: `Theme ${themes.length + 1}`,
                strength: 1,
                relationship: 'Strong'
            };
            themes.push(theme);
            renderThemes();
            calculate();
        }

        function removeTheme(id) {
            themes = themes.filter(t => t.id !== id);
            renderThemes();
            calculate();
        }

        function updateTheme(id, field, value) {
            const theme = themes.find(t => t.id === id);
            if (theme) {
                theme[field] = field === 'strength' ? parseInt(value) : value;
                calculate();
            }
        }

        function renderThemes() {
            const container = document.getElementById('theme-list');
            if (themes.length === 0) {
                container.innerHTML = '<div style="color: #666; text-align: center; padding: 20px;">No themes added. Click "+ Add Theme" to add one.</div>';
                return;
            }

            container.innerHTML = themes.map(theme => {
                const impact = calculateThemeImpact(theme.strength, theme.relationship);
                const impactColor = impact > 0 ? '#22c55e' : impact < 0 ? '#ef4444' : '#888';
                
                return `
                    <div class="theme-item">
                        <input type="text" value="${theme.name}" 
                               onchange="updateTheme(${theme.id}, 'name', this.value)"
                               style="background: transparent; border: none; color: #e0e0e0; font-size: 14px; font-weight: 600;">
                        <div class="theme-controls">
                            <select class="strength-select strength-${theme.strength >= 0 ? 'plus' : 'minus'}-${Math.abs(theme.strength)}" 
                                    onchange="updateTheme(${theme.id}, 'strength', this.value)">
                                <option value="2" ${theme.strength === 2 ? 'selected' : ''}>+2</option>
                                <option value="1" ${theme.strength === 1 ? 'selected' : ''}>+1</option>
                                <option value="0" ${theme.strength === 0 ? 'selected' : ''}>0</option>
                                <option value="-1" ${theme.strength === -1 ? 'selected' : ''}>-1</option>
                                <option value="-2" ${theme.strength === -2 ? 'selected' : ''}>-2</option>
                            </select>
                            <select class="relationship-select" 
                                    onchange="updateTheme(${theme.id}, 'relationship', this.value)">
                                <option value="Strong" ${theme.relationship === 'Strong' ? 'selected' : ''}>Strong</option>
                                <option value="Weak" ${theme.relationship === 'Weak' ? 'selected' : ''}>Weak</option>
                            </select>
                            <span class="theme-impact" style="color: ${impactColor};">${impact > 0 ? '+' : ''}${impact}</span>
                        </div>
                        <button class="remove-btn" onclick="removeTheme(${theme.id})">×</button>
                    </div>
                `;
            }).join('');
        }

        function calculateThemeImpact(strength, relationship) {
            const multiplier = relationship === 'Strong' ? 1.0 : 0.5;
            return strength * 10 * multiplier;
        }

        function calculate() {
            // Get inputs
            const consumerScore = parseFloat(document.getElementById('consumer-score').value) || 0;
            const webYoY = parseFloat(document.getElementById('web-yoy').value) || 0;
            const headlineScore = parseFloat(document.getElementById('headline-score').value) || 0;
            const tickerScore = parseFloat(document.getElementById('ticker-score').value) || 0;
            const stockQoQ = parseFloat(document.getElementById('stock-qoq').value) || 0;

            // === MAIN STREET SCORE ===
            const [gradeMin, gradeMax] = gradeRanges[selectedGrade];
            
            // Normalize Web Data
            let webScore;
            if (webYoY <= -50) {
                webScore = 0;
            } else if (webYoY >= 50) {
                webScore = 100;
            } else {
                webScore = webYoY + 50;
            }

            // Combine (50/50 weight)
            const combinedScore = (consumerScore * 0.5) + (webScore * 0.5);

            // Map to grade range
            const mainStreetScore = gradeMin + (combinedScore / 100) * (gradeMax - gradeMin);

            // Display calculation
            document.getElementById('main-street-calc').innerHTML = `
                Grade ${selectedGrade}: [${gradeMin}-${gradeMax}]<br>
                Web: ${webYoY}% → ${webScore.toFixed(0)}<br>
                (${consumerScore}×0.5 + ${webScore.toFixed(0)}×0.5)<br>
                = ${combinedScore.toFixed(1)}<br>
                ${gradeMin} + ${combinedScore.toFixed(1)}% of range
            `;
            document.getElementById('main-street-result').textContent = mainStreetScore.toFixed(1);

            // === WALL STREET SCORE ===
            // Normalize Stock Price
            let stockScore;
            if (stockQoQ <= -50) {
                stockScore = 0;
            } else if (stockQoQ >= 50) {
                stockScore = 100;
            } else {
                stockScore = stockQoQ + 50;
            }

            // Weighted average (1:1:2)
            const wallStreetScore = (headlineScore * 1 + tickerScore * 1 + stockScore * 2) / 4;

            // Display calculation
            document.getElementById('wall-street-calc').innerHTML = `
                Stock: ${stockQoQ}% → ${stockScore.toFixed(0)}<br>
                (${headlineScore}×1 + ${tickerScore}×1<br>
                + ${stockScore.toFixed(0)}×2) / 4<br>
                = ${wallStreetScore.toFixed(1)}
            `;
            document.getElementById('wall-street-result').textContent = wallStreetScore.toFixed(1);

            // === THEME SCORE ===
            let themeScore = 0;
            let themeCalcSteps = '';

            if (themes.length === 0) {
                themeCalcSteps = 'No themes added';
            } else {
                themes.forEach(theme => {
                    const impact = calculateThemeImpact(theme.strength, theme.relationship);
                    themeScore += impact;
                    const sign = impact > 0 ? '+' : '';
                    themeCalcSteps += `${theme.name}: ${sign}${impact}<br>`;
                });

                const uncappedTheme = themeScore;
                if (themeScore > 50) {
                    themeScore = 50;
                    themeCalcSteps += `<br>Uncapped: ${uncappedTheme}<br>Capped at: +50`;
                } else if (themeScore < -50) {
                    themeScore = -50;
                    themeCalcSteps += `<br>Uncapped: ${uncappedTheme}<br>Capped at: -50`;
                }
            }

            document.getElementById('theme-calc').innerHTML = themeCalcSteps;
            document.getElementById('theme-result').textContent = themeScore.toFixed(1);
            document.getElementById('theme-result').style.color = themeScore > 0 ? '#22c55e' : themeScore < 0 ? '#ef4444' : '#888';

            // === FINAL RECOMMENDATION ===
            const rawScore = mainStreetScore + themeScore - wallStreetScore;
            const normalizedScore = ((rawScore + 150) / 300) * 100;

            // Display final calculation - moved to breakdown

            // Determine recommendation
            let recommendation, recClass;
            if (normalizedScore >= 80) {
                recommendation = 'STRONG BUY';
                recClass = 'rec-strong-buy';
            } else if (normalizedScore >= 60) {
                recommendation = 'BUY';
                recClass = 'rec-buy';
            } else if (normalizedScore >= 40) {
                recommendation = 'NEUTRAL';
                recClass = 'rec-neutral';
            } else if (normalizedScore >= 20) {
                recommendation = 'SELL';
                recClass = 'rec-sell';
            } else {
                recommendation = 'STRONG SELL';
                recClass = 'rec-strong-sell';
            }

            // Update display
            const recElement = document.getElementById('recommendation');
            recElement.textContent = recommendation;
            recElement.className = 'rec-label ' + recClass;
            document.getElementById('normalized-score').textContent = normalizedScore.toFixed(1);

            // Update breakdown
            const sign = themeScore >= 0 ? '+' : '';
            document.getElementById('breakdown').innerHTML = `
                ${mainStreetScore.toFixed(1)} ${sign}${themeScore.toFixed(1)} - ${wallStreetScore.toFixed(1)} = ${rawScore.toFixed(1)}<br>
                <span style="font-size: 10px; color: #666;">Normalized: (${rawScore.toFixed(1)} + 150) / 300 × 100 = ${normalizedScore.toFixed(1)}</span>
            `;
        }

        // Initialize
        renderThemes();
        calculate();
    </script>
</body>
</html>

